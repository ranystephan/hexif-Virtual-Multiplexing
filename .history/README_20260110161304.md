# hexif-Virtual-Multiplexing

## ðŸ”¬ Core Viewer

An interactive web-based viewer for visualizing H&E images, ORION ground truth, and model predictions.

### Quick Start

```bash
# Install dependencies
pip install -r requirements_viewer.txt

# Run the viewer
streamlit run viewer.py
```

Then open your browser to `http://localhost:8501`

### Usage on VS Code Code-Server

Since you're running on a remote code-server, you'll need to forward the port:

1. **Start the viewer:**
   ```bash
   streamlit run viewer.py --server.port 8501 --server.headless true
   ```

2. **Forward the port:** In VS Code, use the "Ports" panel (usually at the bottom) to forward port 8501.

3. **Access the viewer:** Click the forwarded URL or navigate to `localhost:8501` in your browser.

### Features

- **Side-by-side comparison:** H&E | Ground Truth | Prediction
- **Channel selection:** Choose any of the 20 ORION channels with marker names
- **Adjustable intensity range:** Control visualization contrast
- **Multiple colormaps:** viridis, magma, plasma, and more
- **Per-channel metrics:** MSE, MAE, Pearson correlation, SSIM
- **Multi-channel overview:** See all channels at once
- **Core navigation:** Easily browse through all cores

### Configuration

Configure the viewer via the sidebar:

| Option | Description |
|--------|-------------|
| **Pairs Directory** | Path to your `core_*_HE.npy` and `core_*_ORION.npy` files |
| **Model Checkpoint** | Path to trained model (`.pth`) for predictions |
| **Scaler JSON** | Path to `orion_scaler.json` if not in checkpoint |
| **Patch Size** | Inference patch size (default: 224) |
| **Stride** | Sliding window stride (default: 112) |
| **Device** | cpu, cuda, or mps |

### Example Commands

```bash
# View-only mode (no predictions)
streamlit run viewer.py

# With trained model
streamlit run viewer.py  # Then configure paths in sidebar

# Or use the launch script
./run_viewer.sh --pairs_dir /path/to/data --checkpoint /path/to/model.pth
```
